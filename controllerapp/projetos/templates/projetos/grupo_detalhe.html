{% extends 'layout.html' %}
{% load static %}

{% block title %}{{ grupo.nome }}{% endblock %}

{% block head %}
<style>
  .gd-hero{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:2rem 0 1.5rem;position:relative;overflow:hidden}
  .gd-hero::after{content:'';position:absolute;top:-30%;right:-15%;width:50%;height:160%;background:rgba(255,255,255,.04);border-radius:50%;transform:rotate(15deg)}
  .gd-hero h1{font-size:1.4rem;font-weight:800;margin:0}
  .gd-hero-meta{opacity:.7;font-size:.82rem;margin-top:.3rem;display:flex;gap:1rem}

  .gd-btn{display:inline-flex;align-items:center;justify-content:center;padding:.45rem 1rem;border-radius:var(--radius-sm);font-size:.8rem;font-weight:600;text-decoration:none;transition:all var(--transition);cursor:pointer;border:none;gap:.35rem}
  .gd-btn-outline{background:transparent;color:rgba(255,255,255,.8);border:1.5px solid rgba(255,255,255,.3)}
  .gd-btn-outline:hover{background:rgba(255,255,255,.1);color:#fff;border-color:rgba(255,255,255,.5)}
  .gd-btn-primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff}
  .gd-btn-primary:hover{color:#fff;transform:translateY(-1px);box-shadow:0 4px 12px rgba(11,37,69,.15)}
  .gd-btn-outline-dark{background:transparent;color:var(--text-muted);border:1.5px solid var(--border);text-decoration:none}
  .gd-btn-outline-dark:hover{border-color:var(--accent);color:var(--accent)}
  .gd-btn-sm{padding:.3rem .7rem;font-size:.72rem}

  .gd-layout{display:grid;grid-template-columns:320px 1fr;gap:1.25rem;margin-top:1.5rem}
  @media(max-width:900px){.gd-layout{grid-template-columns:1fr}}

  .gd-sidebar{display:flex;flex-direction:column;gap:1rem}
  .gd-panel{background:var(--white);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
  .gd-panel-head{padding:.75rem 1rem;background:var(--surface-alt);border-bottom:1px solid var(--border);font-size:.82rem;font-weight:700;color:var(--primary);display:flex;justify-content:space-between;align-items:center}
  .gd-panel-body{padding:.5rem 0}
  .gd-badge-num{background:rgba(19,103,138,.1);color:var(--accent);min-width:20px;text-align:center;border-radius:50px;padding:.1rem .4rem;font-size:.68rem;font-weight:700}

  .gd-member{display:flex;align-items:center;gap:.65rem;padding:.55rem 1rem;border-bottom:1px solid var(--border);transition:background var(--transition)}
  .gd-member:last-child{border-bottom:none}
  .gd-member:hover{background:var(--surface)}
  .gd-member-avatar{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.65rem;font-weight:700;color:#fff;text-transform:uppercase;flex-shrink:0}
  .gd-member-name{font-size:.82rem;font-weight:600;color:var(--text)}
  .gd-member-role{font-size:.66rem;color:var(--text-muted)}
  .gd-role-super{color:#8B5CF6}.gd-role-staff{color:#3B82F6}

  .gd-project{display:flex;align-items:center;gap:.5rem;padding:.55rem 1rem;border-bottom:1px solid var(--border);transition:background var(--transition);text-decoration:none;color:inherit}
  .gd-project:last-child{border-bottom:none}
  .gd-project:hover{background:var(--surface)}
  .gd-project-title{font-size:.82rem;font-weight:600;color:var(--text);flex:1}
  .gd-st-pill{padding:.1rem .4rem;border-radius:50px;font-size:.6rem;font-weight:700}
  .gd-st-em_andamento{background:rgba(59,130,246,.1);color:#2563EB}
  .gd-st-concluido{background:rgba(16,185,129,.1);color:#059669}
  .gd-st-planejado{background:rgba(139,92,246,.1);color:#7C3AED}
  .gd-st-cancelado{background:rgba(107,114,128,.1);color:#6B7280}

  /* Tasks */
  .gd-tasks{background:var(--white);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
  .gd-task{padding:.85rem 1.1rem;border-bottom:1px solid var(--border);display:flex;align-items:flex-start;gap:.65rem;transition:background var(--transition);position:relative}
  .gd-task:last-child{border-bottom:none}
  .gd-task:hover{background:var(--surface)}
  .gd-task-pri{width:4px;border-radius:2px;align-self:stretch;flex-shrink:0}
  .gd-task-pri-baixa{background:#10B981}.gd-task-pri-media{background:#F59E0B}.gd-task-pri-alta{background:#EF4444}.gd-task-pri-urgente{background:#B91C1C}
  .gd-task-info{flex:1;min-width:0}
  .gd-task-title{font-size:.85rem;font-weight:600;color:var(--text)}
  .gd-task-done .gd-task-title{text-decoration:line-through;color:var(--text-muted)}
  .gd-task-meta{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.3rem;font-size:.7rem;color:var(--text-muted)}
  .gd-task-meta span{display:inline-flex;align-items:center;gap:.2rem}
  .gd-task-badges{display:flex;gap:.3rem;flex-shrink:0;align-self:center}

  .gd-empty{padding:2rem 1rem;text-align:center;color:var(--text-muted);font-size:.82rem}
  .gd-empty i{font-size:1.5rem;opacity:.3;display:block;margin-bottom:.5rem}
</style>
{% endblock %}

{% block content %}
<section class="gd-hero">
  <div class="container" style="position:relative;z-index:1">
    <nav style="font-size:.75rem;margin-bottom:.5rem;opacity:.6">
      <a href="{% url 'projetos:gestao' %}" style="color:#fff;text-decoration:none">Gestão</a> /
      <a href="{% url 'projetos:grupos_lista' %}" style="color:#fff;text-decoration:none">Grupos</a> /
      <span>{{ grupo.nome }}</span>
    </nav>
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
      <div>
        <h1><i class="fas fa-users me-2"></i>{{ grupo.nome }}</h1>
        <div class="gd-hero-meta">
          <span><i class="fas fa-user me-1"></i>{{ grupo.membros.count }} membro{{ grupo.membros.count|pluralize }}</span>
          <span><i class="fas fa-folder me-1"></i>{{ grupo.projetos.count }} projeto{{ grupo.projetos.count|pluralize }}</span>
          <span><i class="fas fa-tasks me-1"></i>{{ tarefas.count }} tarefa{{ tarefas.count|pluralize }}</span>
        </div>
      </div>
      <div class="d-flex gap-2">
        <a href="{% url 'projetos:grupo_editar' grupo.id %}" class="gd-btn gd-btn-outline"><i class="fas fa-edit"></i> Editar</a>
        <a href="{% url 'projetos:grupos_lista' %}" class="gd-btn gd-btn-outline"><i class="fas fa-arrow-left"></i> Voltar</a>
      </div>
    </div>
  </div>
</section>

<div class="container" style="padding-bottom:3rem">
  <div class="gd-layout">
    <!-- Sidebar -->
    <div class="gd-sidebar">
      <!-- Membros -->
      <div class="gd-panel">
        <div class="gd-panel-head"><span><i class="fas fa-users me-1"></i> Membros</span><span class="gd-badge-num">{{ grupo.membros.count }}</span></div>
        <div class="gd-panel-body">
          {% for m in grupo.membros.all %}
          <div class="gd-member">
            <div class="gd-member-avatar" style="background:{% cycle '#4B89DC' '#967ADC' '#D770AD' '#F6BB42' '#37BC9B' %}">{{ m.first_name|slice:":1" }}{{ m.last_name|slice:":1" }}</div>
            <div>
              <div class="gd-member-name">{{ m.get_full_name|default:m.username }}</div>
              <div class="gd-member-role {% if m.is_superuser %}gd-role-super{% elif m.is_staff %}gd-role-staff{% endif %}">
                {% if m.is_superuser %}Superusuário{% elif m.is_staff %}Staff{% else %}Usuário{% endif %}
              </div>
            </div>
          </div>
          {% empty %}
          <div class="gd-empty"><i class="fas fa-user-slash"></i>Nenhum membro</div>
          {% endfor %}
        </div>
      </div>

      <!-- Projetos -->
      <div class="gd-panel">
        <div class="gd-panel-head"><span><i class="fas fa-folder me-1"></i> Projetos</span><span class="gd-badge-num">{{ grupo.projetos.count }}</span></div>
        <div class="gd-panel-body">
          {% for p in grupo.projetos.all %}
          <a href="{% url 'projetos:detalhe' p.slug %}" class="gd-project">
            <span class="gd-project-title">{{ p.titulo }}</span>
            <span class="gd-st-pill gd-st-{{ p.status|lower }}">{{ p.get_status_display }}</span>
          </a>
          {% empty %}
          <div class="gd-empty"><i class="fas fa-folder-open"></i>Nenhum projeto</div>
          {% endfor %}
        </div>
      </div>

      {% if grupo.descricao %}
      <div class="gd-panel">
        <div class="gd-panel-head"><span><i class="fas fa-info-circle me-1"></i> Descrição</span></div>
        <div style="padding:.85rem 1rem;font-size:.82rem;color:var(--text-muted);line-height:1.5">{{ grupo.descricao }}</div>
      </div>
      {% endif %}
    </div>

    <!-- Main: Tasks -->
    <div>
      <div class="gd-tasks">
        <div class="gd-panel-head"><span><i class="fas fa-tasks me-1"></i> Tarefas do Grupo</span><span class="gd-badge-num">{{ tarefas.count }}</span></div>
        {% for task in tarefas %}
        <div class="gd-task {% if task.concluida %}gd-task-done{% endif %}">
          <div class="gd-task-pri gd-task-pri-{{ task.prioridade }}"></div>
          <div class="gd-task-info">
            <div class="gd-task-title">{{ task.titulo }}</div>
            <div class="gd-task-meta">
              {% if task.projeto %}<span><i class="fas fa-folder"></i> {{ task.projeto.titulo }}</span>{% endif %}
              {% if task.usuario %}<span><i class="fas fa-user"></i> {{ task.usuario.first_name|default:task.usuario.username }}</span>{% endif %}
              {% if task.data_limite %}<span><i class="fas fa-calendar-alt"></i> {{ task.data_limite|date:"d/m/Y" }}</span>{% endif %}
            </div>
            {% if task.descricao %}<p style="font-size:.76rem;color:var(--text-muted);margin:.3rem 0 0;line-height:1.4">{{ task.descricao|truncatewords:20 }}</p>{% endif %}
          </div>
          <div class="gd-task-badges">
            <span class="gd-st-pill" style="background:{% if task.prioridade == 'urgente' %}rgba(220,38,38,.12){% elif task.prioridade == 'alta' %}rgba(239,68,68,.1){% elif task.prioridade == 'media' %}rgba(245,158,11,.1){% else %}rgba(16,185,129,.1){% endif %};color:{% if task.prioridade == 'urgente' %}#B91C1C{% elif task.prioridade == 'alta' %}#DC2626{% elif task.prioridade == 'media' %}#D97706{% else %}#059669{% endif %}">{{ task.get_prioridade_display }}</span>
            {% if task.concluida %}<span class="gd-st-pill" style="background:rgba(16,185,129,.1);color:#059669">Concluída</span>{% endif %}
          </div>
        </div>
        {% empty %}
        <div class="gd-empty" style="padding:3rem"><i class="fas fa-clipboard-check"></i>Nenhuma tarefa atribuída a este grupo</div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}