{% extends 'layout.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Lista de Tarefas{% endblock %}

{% block head %}
<style>
  /* ── Hero ── */
  .td-hero{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:2rem 0 1.5rem;position:relative;overflow:hidden}
  .td-hero::after{content:'';position:absolute;top:-30%;right:-15%;width:50%;height:160%;background:rgba(255,255,255,.04);border-radius:50%;transform:rotate(15deg)}
  .td-hero h1{font-size:1.4rem;font-weight:800;margin:0}
  .td-hero p{opacity:.7;font-size:.85rem;margin:.25rem 0 0}

  /* ── Stats ── */
  .td-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:.75rem;margin-top:-1.5rem;position:relative;z-index:2}
  .td-stat{background:var(--white);border:1px solid var(--border);border-radius:var(--radius);padding:.9rem 1rem;text-align:center;transition:all var(--transition)}
  .td-stat:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(11,37,69,.08)}
  .td-stat-val{font-size:1.6rem;font-weight:800;line-height:1}
  .td-stat-lbl{font-size:.68rem;color:var(--text-muted);font-weight:500;margin-top:.2rem}

  /* ── Filters ── */
  .td-filters{background:var(--white);border:1px solid var(--border);border-radius:var(--radius);padding:1rem 1.25rem;margin-top:1.25rem}
  .td-filters-row{display:flex;flex-wrap:wrap;gap:.65rem;align-items:flex-end}
  .td-fg{flex:1;min-width:140px}
  .td-fg label{display:block;font-size:.7rem;font-weight:600;color:var(--text-muted);margin-bottom:.25rem;text-transform:uppercase;letter-spacing:.3px}
  .td-fg select{width:100%;padding:.4rem .65rem;border:1.5px solid var(--border);border-radius:var(--radius-sm);font-size:.8rem;font-family:inherit;color:var(--text);background:var(--white);transition:border var(--transition)}
  .td-fg select:focus{outline:none;border-color:var(--accent)}
  .td-filter-actions{display:flex;gap:.5rem;align-items:flex-end}

  /* ── Buttons ── */
  .td-btn{display:inline-flex;align-items:center;justify-content:center;padding:.45rem 1rem;border-radius:var(--radius-sm);font-size:.8rem;font-weight:600;text-decoration:none;transition:all var(--transition);cursor:pointer;border:none;gap:.35rem}
  .td-btn-primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff}
  .td-btn-primary:hover{color:#fff;transform:translateY(-1px);box-shadow:0 4px 12px rgba(11,37,69,.15)}
  .td-btn-outline{background:transparent;color:var(--text-muted);border:1.5px solid var(--border)}
  .td-btn-outline:hover{border-color:var(--accent);color:var(--accent)}
  .td-btn-sm{padding:.3rem .7rem;font-size:.72rem}
  .td-btn-danger{background:rgba(239,68,68,.08);color:#DC2626;border:1.5px solid rgba(239,68,68,.2)}
  .td-btn-danger:hover{background:#EF4444;color:#fff;border-color:#EF4444}
  .td-btn-success{background:rgba(16,185,129,.08);color:#059669;border:1.5px solid rgba(16,185,129,.2)}
  .td-btn-success:hover{background:#10B981;color:#fff;border-color:#10B981}

  /* ── Task Grid ── */
  .td-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:.85rem;margin-top:1.25rem}

  /* ── Task Card ── */
  .td-card{background:var(--white);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;transition:all var(--transition);position:relative;display:flex;flex-direction:column}
  .td-card:hover{box-shadow:0 6px 18px rgba(11,37,69,.08);transform:translateY(-2px)}
  .td-card-done{opacity:.6}
  .td-card-done .td-card-title{text-decoration:line-through;color:var(--text-muted)}
  .td-card-pri{position:absolute;top:0;left:0;width:4px;height:100%;border-radius:var(--radius) 0 0 var(--radius)}
  .td-pri-baixa{background:#10B981}.td-pri-media{background:#F59E0B}.td-pri-alta{background:#EF4444}.td-pri-urgente{background:#B91C1C}

  .td-card-head{padding:.85rem 1rem .5rem 1.25rem;display:flex;align-items:flex-start;gap:.65rem}
  .td-card-check{margin-top:.15rem;flex-shrink:0}
  .td-card-check input[type=checkbox]{width:18px;height:18px;accent-color:var(--accent);cursor:pointer}
  .td-card-title{font-size:.88rem;font-weight:600;color:var(--text);flex:1;line-height:1.35}
  .td-card-badge{flex-shrink:0}
  .td-pri-pill{padding:.15rem .45rem;border-radius:50px;font-size:.62rem;font-weight:700;text-transform:uppercase;letter-spacing:.3px}

  .td-card-body{padding:0 1rem .75rem 2.75rem;flex:1}
  .td-card-meta{display:flex;flex-wrap:wrap;gap:.5rem;font-size:.72rem;color:var(--text-muted)}
  .td-card-meta span{display:inline-flex;align-items:center;gap:.25rem}
  .td-card-desc{font-size:.76rem;color:var(--text-muted);margin-top:.4rem;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
  .td-overdue{color:#DC2626!important;font-weight:600}

  .td-card-foot{padding:.5rem 1rem;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:.4rem}

  /* ── Empty ── */
  .td-empty{text-align:center;padding:3rem 1rem;color:var(--text-muted)}
  .td-empty i{font-size:2.5rem;opacity:.25;display:block;margin-bottom:.75rem}
  .td-empty h4{font-size:.95rem;font-weight:600;margin:0 0 .3rem}
  .td-empty p{font-size:.82rem;margin:0}

  /* ── Modal ── */
  .td-modal .modal-content{border:none;border-radius:var(--radius);overflow:hidden}
  .td-modal .modal-header{background:var(--surface-alt);border-bottom:1px solid var(--border);padding:.85rem 1.25rem}
  .td-modal .modal-title{font-size:.92rem;font-weight:700;color:var(--primary)}
  .td-modal .modal-body{padding:1.25rem}
  .td-modal .modal-footer{border-top:1px solid var(--border);padding:.65rem 1.25rem}
  .td-modal label{font-size:.76rem;font-weight:600;color:var(--text);margin-bottom:.25rem;display:block}
  .td-modal input,.td-modal select,.td-modal textarea{width:100%;padding:.45rem .75rem;border:1.5px solid var(--border);border-radius:var(--radius-sm);font-size:.82rem;font-family:inherit;color:var(--text);transition:border var(--transition)}
  .td-modal input:focus,.td-modal select:focus,.td-modal textarea:focus{outline:none;border-color:var(--accent)}

  @media(max-width:768px){.td-stats{grid-template-columns:repeat(2,1fr)}.td-grid{grid-template-columns:1fr}.td-filters-row{flex-direction:column}}
</style>
{% endblock %}

{% block content %}
<div id="toast-container" style="position:fixed;top:20px;right:20px;z-index:1055"></div>

<!-- Hero -->
<section class="td-hero">
  <div class="container">
    <h1><i class="fas fa-check-square me-2"></i>Lista de Tarefas</h1>
    <p>Gerencie suas tarefas pessoais e de grupo</p>
  </div>
</section>

<div class="container" style="padding-bottom:3rem">
  <!-- Stats -->
  <div class="td-stats">
    <div class="td-stat"><span class="td-stat-val" style="color:var(--accent)" id="stat-total">{{ total_tarefas }}</span><span class="td-stat-lbl">Total</span></div>
    <div class="td-stat"><span class="td-stat-val" style="color:#F59E0B" id="stat-pending">{{ tarefas_pendentes }}</span><span class="td-stat-lbl">Pendentes</span></div>
    <div class="td-stat"><span class="td-stat-val" style="color:#10B981" id="stat-done">{{ tarefas_concluidas }}</span><span class="td-stat-lbl">Concluídas</span></div>
    <div class="td-stat"><span class="td-stat-val" style="color:#EF4444" id="stat-overdue">{{ tarefas_atrasadas }}</span><span class="td-stat-lbl">Atrasadas</span></div>
  </div>

  <!-- Filters + Add Button -->
  <div class="td-filters">
    <form method="get" id="filterForm">
      <div class="td-filters-row">
        <div class="td-fg">
          <label>Status</label>
          <select name="status" onchange="this.form.submit()">
            <option value="all" {% if filtro_status == 'all' %}selected{% endif %}>Todos</option>
            <option value="pending" {% if filtro_status == 'pending' %}selected{% endif %}>Pendentes</option>
            <option value="completed" {% if filtro_status == 'completed' %}selected{% endif %}>Concluídas</option>
          </select>
        </div>
        <div class="td-fg">
          <label>Prioridade</label>
          <select name="prioridade" onchange="this.form.submit()">
            <option value="">Todas</option>
            <option value="urgente" {% if filtro_prioridade == 'urgente' %}selected{% endif %}>Urgente</option>
            <option value="alta" {% if filtro_prioridade == 'alta' %}selected{% endif %}>Alta</option>
            <option value="media" {% if filtro_prioridade == 'media' %}selected{% endif %}>Média</option>
            <option value="baixa" {% if filtro_prioridade == 'baixa' %}selected{% endif %}>Baixa</option>
          </select>
        </div>
        <div class="td-fg">
          <label>Projeto</label>
          <select name="projeto" onchange="this.form.submit()">
            <option value="">Todos</option>
            {% for p in projetos %}
            <option value="{{ p.id }}" {% if filtro_projeto == p.id|stringformat:"d" %}selected{% endif %}>{{ p.titulo }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="td-fg">
          <label>Grupo</label>
          <select name="grupo" onchange="this.form.submit()">
            <option value="">Todos</option>
            {% for g in grupos %}
            <option value="{{ g.id }}" {% if filtro_grupo == g.id|stringformat:"d" %}selected{% endif %}>{{ g.nome }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="td-fg">
          <label>Ordenar</label>
          <select name="order_by" onchange="this.form.submit()">
            <option value="data_limite" {% if order_by == 'data_limite' %}selected{% endif %}>Prazo</option>
            <option value="prioridade" {% if order_by == 'prioridade' %}selected{% endif %}>Prioridade</option>
            <option value="data_criacao" {% if order_by == 'data_criacao' %}selected{% endif %}>Criação</option>
            <option value="titulo" {% if order_by == 'titulo' %}selected{% endif %}>Título</option>
          </select>
          <input type="hidden" name="direction" value="{{ direction }}">
        </div>
        <div class="td-filter-actions">
          <button type="button" onclick="toggleDirection()" class="td-btn td-btn-outline td-btn-sm" title="Inverter ordem">
            <i class="fas fa-sort-amount-{% if direction == 'asc' %}up{% else %}down{% endif %}"></i>
          </button>
          <a href="{% url 'projetos:todo_list' %}" class="td-btn td-btn-outline td-btn-sm" title="Limpar filtros"><i class="fas fa-times"></i></a>
          <button type="button" class="td-btn td-btn-primary" data-bs-toggle="modal" data-bs-target="#addTaskModal"><i class="fas fa-plus"></i> Nova Tarefa</button>
        </div>
      </div>
    </form>
  </div>

  <!-- Tasks Grid -->
  {% if tarefas %}
  <div class="td-grid">
    {% for task in tarefas %}
    <div class="td-card {% if task.concluida %}td-card-done{% endif %}"
         id="task-{{ task.id }}"
         data-id="{{ task.id }}"
         data-titulo="{{ task.titulo }}"
         data-descricao="{{ task.descricao|default:'' }}"
         data-prioridade="{{ task.prioridade }}"
         data-projeto="{{ task.projeto_id|default:'' }}"
         data-grupo="{{ task.grupo_id|default:'' }}"
         data-data-limite="{{ task.data_limite|date:'Y-m-d'|default:'' }}"
         data-concluida="{{ task.concluida|yesno:'true,false' }}"
         data-usuario="{{ task.usuario.get_full_name|default:task.usuario.username|default:'Grupo' }}"
         ondblclick="showTaskDetails({{ task.id }})">
      <div class="td-card-pri td-pri-{{ task.prioridade }}"></div>
      <div class="td-card-head">
        <div class="td-card-check">
          <input type="checkbox" {% if task.concluida %}checked{% endif %} onchange="toggleTaskDone({{ task.id }}, this.checked)">
        </div>
        <span class="td-card-title">{{ task.titulo }}</span>
        <div class="td-card-badge">
          <span class="td-pri-pill td-pri-bg-{{ task.prioridade }}">{{ task.get_prioridade_display }}</span>
        </div>
      </div>
      <div class="td-card-body">
        <div class="td-card-meta">
          {% if task.projeto %}<span><i class="fas fa-folder"></i> {{ task.projeto.titulo }}</span>{% endif %}
          {% if task.grupo %}<span><i class="fas fa-users"></i> {{ task.grupo.nome }}</span>{% endif %}
          {% if task.usuario %}<span><i class="fas fa-user"></i> {{ task.usuario.first_name|default:task.usuario.username }}</span>{% endif %}
          {% if task.data_limite %}
            <span class="{% if task.esta_atrasada %}td-overdue{% endif %}">
              <i class="fas fa-calendar-alt"></i>
              {{ task.data_limite|date:"d/m/Y" }}
              {% if task.dias_restantes != None %}
                {% if task.dias_restantes < 0 %}({{ task.dias_restantes|abs }}d atrasada)
                {% elif task.dias_restantes == 0 %}(Hoje!)
                {% else %}({{ task.dias_restantes }}d)
                {% endif %}
              {% endif %}
            </span>
          {% endif %}
        </div>
        {% if task.descricao %}<p class="td-card-desc">{{ task.descricao }}</p>{% endif %}
      </div>
      <div class="td-card-foot">
        {% if task.grupo and not user.is_superuser %}
          <button class="td-btn td-btn-outline td-btn-sm" onclick="showTaskDetails({{ task.id }})"><i class="fas fa-eye"></i></button>
        {% else %}
          <button class="td-btn td-btn-outline td-btn-sm" onclick="openEditModal({{ task.id }})"><i class="fas fa-edit"></i></button>
          <form method="post" action="{% url 'projetos:delete_task' task.id %}" style="display:inline" onsubmit="return confirm('Excluir esta tarefa?')">
            {% csrf_token %}
            <button class="td-btn td-btn-danger td-btn-sm"><i class="fas fa-trash"></i></button>
          </form>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="td-empty" style="margin-top:2rem">
    <i class="fas fa-clipboard-check"></i>
    <h4>Nenhuma tarefa encontrada</h4>
    <p>Crie uma nova tarefa ou ajuste os filtros</p>
  </div>
  {% endif %}
</div>

<!-- Modal: Add Task -->
<div class="modal fade td-modal" id="addTaskModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form method="post" action="{% url 'projetos:add_task' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-plus-circle me-2"></i>Nova Tarefa</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="add-titulo">Título *</label>
            <input type="text" name="titulo" id="add-titulo" required placeholder="Nome da tarefa">
          </div>
          <div class="mb-3">
            <label for="add-descricao">Descrição</label>
            <textarea name="descricao" id="add-descricao" rows="3" placeholder="Detalhes opcionais..."></textarea>
          </div>
          <div class="row g-3">
            <div class="col-6">
              <label for="add-prioridade">Prioridade</label>
              <select name="prioridade" id="add-prioridade">
                <option value="baixa">Baixa</option>
                <option value="media" selected>Média</option>
                <option value="alta">Alta</option>
                <option value="urgente">Urgente</option>
              </select>
            </div>
            <div class="col-6">
              <label for="add-data_limite">Prazo</label>
              <input type="date" name="data_limite" id="add-data_limite">
            </div>
          </div>
          <div class="row g-3 mt-0">
            <div class="col-6">
              <label for="add-projeto">Projeto</label>
              <select name="projeto" id="add-projeto">
                <option value="">Nenhum</option>
                {% for p in projetos %}<option value="{{ p.id }}">{{ p.titulo }}</option>{% endfor %}
              </select>
            </div>
            <div class="col-6">
              <label for="add-grupo">Grupo</label>
              <select name="grupo" id="add-grupo">
                <option value="">Pessoal</option>
                {% for g in grupos %}<option value="{{ g.id }}">{{ g.nome }}</option>{% endfor %}
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="td-btn td-btn-outline" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="td-btn td-btn-primary"><i class="fas fa-check me-1"></i>Criar Tarefa</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal: Edit Task -->
<div class="modal fade td-modal" id="editTaskModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form method="post" id="editTaskForm">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Editar Tarefa</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="edit-titulo">Título *</label>
            <input type="text" name="titulo" id="edit-titulo" required>
          </div>
          <div class="mb-3">
            <label for="edit-descricao">Descrição</label>
            <textarea name="descricao" id="edit-descricao" rows="3"></textarea>
          </div>
          <div class="row g-3">
            <div class="col-6">
              <label for="edit-prioridade">Prioridade</label>
              <select name="prioridade" id="edit-prioridade">
                <option value="baixa">Baixa</option>
                <option value="media">Média</option>
                <option value="alta">Alta</option>
                <option value="urgente">Urgente</option>
              </select>
            </div>
            <div class="col-6">
              <label for="edit-data_limite">Prazo</label>
              <input type="date" name="data_limite" id="edit-data_limite">
            </div>
          </div>
          <div class="row g-3 mt-0">
            <div class="col-6">
              <label for="edit-projeto">Projeto</label>
              <select name="projeto" id="edit-projeto">
                <option value="">Nenhum</option>
                {% for p in projetos %}<option value="{{ p.id }}">{{ p.titulo }}</option>{% endfor %}
              </select>
            </div>
            <div class="col-6">
              <label for="edit-grupo">Grupo</label>
              <select name="grupo" id="edit-grupo">
                <option value="">Pessoal</option>
                {% for g in grupos %}<option value="{{ g.id }}">{{ g.nome }}</option>{% endfor %}
              </select>
            </div>
          </div>
          <div class="mt-3">
            <label class="d-flex align-items-center gap-2" style="cursor:pointer">
              <input type="checkbox" name="concluida" id="edit-concluida" style="width:18px;height:18px;accent-color:var(--accent)">
              <span style="font-size:.82rem">Marcar como concluída</span>
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="td-btn td-btn-outline" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="td-btn td-btn-primary"><i class="fas fa-save me-1"></i>Salvar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal: View Details -->
<div class="modal fade td-modal" id="viewTaskModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-info-circle me-2"></i>Detalhes da Tarefa</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="viewTaskBody"></div>
      <div class="modal-footer">
        <button type="button" class="td-btn td-btn-outline" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<style>
  .td-pri-bg-baixa{background:rgba(16,185,129,.1);color:#059669}
  .td-pri-bg-media{background:rgba(245,158,11,.1);color:#D97706}
  .td-pri-bg-alta{background:rgba(239,68,68,.1);color:#DC2626}
  .td-pri-bg-urgente{background:rgba(220,38,38,.15);color:#B91C1C}
</style>
<script>
function getCookie(name){let v=null;document.cookie.split(';').forEach(c=>{c=c.trim();if(c.startsWith(name+'='))v=decodeURIComponent(c.substring(name.length+1))});return v}

function toggleDirection(){
  const form=document.getElementById('filterForm');
  const dir=form.querySelector('[name=direction]');
  dir.value=dir.value==='asc'?'desc':'asc';
  form.submit();
}

function toggleTaskDone(id,checked){
  const card=document.getElementById('task-'+id);
  const fd=new FormData();
  fd.append('concluida',checked?'true':'false');
  fd.append('csrfmiddlewaretoken',getCookie('csrftoken'));
  fetch(`/projetos/todo/${id}/update/`,{method:'POST',body:fd,headers:{'X-Requested-With':'XMLHttpRequest'}})
    .then(r=>r.json()).then(d=>{
      if(d.status==='success'){
        if(d.concluida){card.classList.add('td-card-done')}else{card.classList.remove('td-card-done')}
        updateStats(d.concluida?1:-1);
        showToast(d.concluida?'Tarefa concluída!':'Tarefa reaberta','success');
      }
    }).catch(()=>showToast('Erro ao atualizar','danger'));
}

function updateStats(delta){
  const done=document.getElementById('stat-done');
  const pend=document.getElementById('stat-pending');
  done.textContent=parseInt(done.textContent)+(delta>0?1:-1);
  pend.textContent=parseInt(pend.textContent)+(delta>0?-1:1);
}

function openEditModal(id){
  const card=document.getElementById('task-'+id);
  document.getElementById('edit-titulo').value=card.dataset.titulo;
  document.getElementById('edit-descricao').value=card.dataset.descricao;
  document.getElementById('edit-prioridade').value=card.dataset.prioridade;
  document.getElementById('edit-projeto').value=card.dataset.projeto;
  document.getElementById('edit-grupo').value=card.dataset.grupo;
  document.getElementById('edit-data_limite').value=card.dataset.dataLimite;
  document.getElementById('edit-concluida').checked=card.dataset.concluida==='true';
  document.getElementById('editTaskForm').action=`/projetos/todo/${id}/update/`;
  new bootstrap.Modal(document.getElementById('editTaskModal')).show();
}

function showTaskDetails(id){
  const card=document.getElementById('task-'+id);
  const priLabels={baixa:'Baixa',media:'Média',alta:'Alta',urgente:'Urgente'};
  const priColors={baixa:'#10B981',media:'#F59E0B',alta:'#EF4444',urgente:'#B91C1C'};
  let html=`<div style="margin-bottom:1rem">
    <h4 style="font-size:1rem;font-weight:700;color:var(--text);margin:0 0 .5rem">${card.dataset.titulo}</h4>
    <span style="display:inline-block;padding:.15rem .5rem;border-radius:50px;font-size:.68rem;font-weight:700;background:${priColors[card.dataset.prioridade]}20;color:${priColors[card.dataset.prioridade]}">${priLabels[card.dataset.prioridade]||card.dataset.prioridade}</span>
    <span style="display:inline-block;padding:.15rem .5rem;border-radius:50px;font-size:.68rem;font-weight:700;background:${card.dataset.concluida==='true'?'rgba(16,185,129,.1)':'rgba(245,158,11,.1)'};color:${card.dataset.concluida==='true'?'#059669':'#D97706'};margin-left:.3rem">${card.dataset.concluida==='true'?'Concluída':'Pendente'}</span>
  </div>`;
  if(card.dataset.descricao)html+=`<p style="font-size:.85rem;color:var(--text-muted);line-height:1.5;margin-bottom:1rem">${card.dataset.descricao}</p>`;
  html+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:.5rem;font-size:.8rem">';
  html+=`<div><strong>Responsável:</strong><br>${card.dataset.usuario}</div>`;
  if(card.dataset.dataLimite)html+=`<div><strong>Prazo:</strong><br>${card.dataset.dataLimite.split('-').reverse().join('/')}</div>`;
  html+='</div>';
  document.getElementById('viewTaskBody').innerHTML=html;
  new bootstrap.Modal(document.getElementById('viewTaskModal')).show();
}

function showToast(msg,type){
  const c=document.getElementById('toast-container');
  const t=document.createElement('div');
  t.className=`toast show align-items-center text-bg-${type} border-0`;
  t.setAttribute('role','alert');
  t.innerHTML=`<div class="d-flex"><div class="toast-body">${msg}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div>`;
  c.appendChild(t);
  setTimeout(()=>t.remove(),3000);
}
</script>
{% endblock %}