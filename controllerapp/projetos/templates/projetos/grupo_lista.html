{% extends 'layout.html' %}
{% load static %}

{% block title %}Grupos de Projetos{% endblock %}

{% block head %}
<style>
  .gr-hero{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:2rem 0 1.5rem;position:relative;overflow:hidden}
  .gr-hero::after{content:'';position:absolute;top:-30%;right:-15%;width:50%;height:160%;background:rgba(255,255,255,.04);border-radius:50%;transform:rotate(15deg)}
  .gr-hero h1{font-size:1.4rem;font-weight:800;margin:0}
  .gr-hero p{opacity:.7;font-size:.85rem;margin:.25rem 0 0}

  .gr-toolbar{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.75rem;margin-top:1.5rem;margin-bottom:1.25rem}
  .gr-search{display:flex;gap:.5rem}
  .gr-search input{padding:.45rem .85rem;border:1.5px solid var(--border);border-radius:var(--radius-sm);font-size:.82rem;font-family:inherit;width:260px;transition:border var(--transition)}
  .gr-search input:focus{outline:none;border-color:var(--accent)}
  .gr-btn{display:inline-flex;align-items:center;justify-content:center;padding:.45rem 1rem;border-radius:var(--radius-sm);font-size:.8rem;font-weight:600;text-decoration:none;transition:all var(--transition);cursor:pointer;border:none;gap:.35rem}
  .gr-btn-primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff}
  .gr-btn-primary:hover{color:#fff;transform:translateY(-1px);box-shadow:0 4px 12px rgba(11,37,69,.15)}
  .gr-btn-outline{background:transparent;color:var(--text-muted);border:1.5px solid var(--border)}
  .gr-btn-outline:hover{border-color:var(--accent);color:var(--accent)}
  .gr-btn-sm{padding:.3rem .7rem;font-size:.72rem}
  .gr-btn-danger-sm{padding:.3rem .7rem;font-size:.72rem;background:rgba(239,68,68,.08);color:#DC2626;border:1.5px solid rgba(239,68,68,.2);border-radius:var(--radius-sm);transition:all var(--transition);cursor:pointer}
  .gr-btn-danger-sm:hover{background:#EF4444;color:#fff;border-color:#EF4444}

  .gr-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1rem}
  .gr-card{background:var(--white);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;transition:all var(--transition);display:flex;flex-direction:column}
  .gr-card:hover{transform:translateY(-3px);box-shadow:0 8px 22px rgba(11,37,69,.1)}
  .gr-card-head{padding:1rem 1.15rem;background:var(--surface-alt);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:.75rem}
  .gr-card-icon{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#8B5CF6,#A78BFA);color:#fff;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0}
  .gr-card-name{font-size:.92rem;font-weight:700;color:var(--text)}
  .gr-card-desc{font-size:.74rem;color:var(--text-muted);margin-top:.1rem;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden}
  .gr-card-body{padding:1rem 1.15rem;flex:1}
  .gr-badges{display:flex;flex-wrap:wrap;gap:.4rem;margin-bottom:.75rem}
  .gr-badge{padding:.15rem .5rem;border-radius:50px;font-size:.65rem;font-weight:700}
  .gr-badge-members{background:rgba(59,130,246,.1);color:#2563EB}
  .gr-badge-projects{background:rgba(139,92,246,.1);color:#7C3AED}
  .gr-badge-tasks{background:rgba(16,185,129,.1);color:#059669}

  .gr-avatars{display:flex;margin-top:.5rem}
  .gr-avatar{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.6rem;font-weight:700;color:#fff;border:2px solid var(--white);margin-left:-6px;text-transform:uppercase}
  .gr-avatar:first-child{margin-left:0}
  .gr-avatar-1{background:#4B89DC}.gr-avatar-2{background:#967ADC}.gr-avatar-3{background:#D770AD}.gr-avatar-4{background:#F6BB42}.gr-avatar-5{background:#37BC9B}
  .gr-avatar-more{background:var(--text-muted)}

  .gr-card-foot{padding:.6rem 1.15rem;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:.4rem}

  .gr-empty{text-align:center;padding:3rem 1rem;color:var(--text-muted)}
  .gr-empty i{font-size:2.5rem;opacity:.25;display:block;margin-bottom:.75rem}

  .gr-pagination{display:flex;justify-content:center;gap:.3rem;margin-top:1.5rem}
  .gr-pagination a,.gr-pagination span{padding:.35rem .7rem;border-radius:var(--radius-sm);font-size:.8rem;font-weight:600;text-decoration:none;border:1.5px solid var(--border);color:var(--text-muted);transition:all var(--transition)}
  .gr-pagination a:hover{border-color:var(--accent);color:var(--accent)}
  .gr-pagination .active{background:var(--accent);color:#fff;border-color:var(--accent)}

  @media(max-width:768px){.gr-grid{grid-template-columns:1fr}.gr-toolbar{flex-direction:column;align-items:stretch}}
</style>
{% endblock %}

{% block content %}
<section class="gr-hero">
  <div class="container">
    <nav style="font-size:.78rem;margin-bottom:.5rem;opacity:.6">
      <a href="{% url 'projetos:gestao' %}" style="color:#fff;text-decoration:none">Gest√£o</a> / <span>Grupos</span>
    </nav>
    <h1><i class="fas fa-users-cog me-2"></i>Grupos de Projetos</h1>
    <p>Gerencie equipes e atribua membros a projetos</p>
  </div>
</section>

<div class="container" style="padding-bottom:3rem">
  <div class="gr-toolbar">
    <form method="get" class="gr-search">
      <input type="text" name="busca" placeholder="Buscar grupos..." value="{{ termo_busca }}">
      <button type="submit" class="gr-btn gr-btn-outline gr-btn-sm"><i class="fas fa-search"></i></button>
      {% if termo_busca %}<a href="{% url 'projetos:grupos_lista' %}" class="gr-btn gr-btn-outline gr-btn-sm"><i class="fas fa-times"></i></a>{% endif %}
    </form>
    <a href="{% url 'projetos:grupo_novo' %}" class="gr-btn gr-btn-primary"><i class="fas fa-plus"></i> Novo Grupo</a>
  </div>

  {% if grupos %}
  <div class="gr-grid">
    {% for grupo in grupos %}
    <div class="gr-card">
      <div class="gr-card-head">
        <div class="gr-card-icon"><i class="fas fa-users"></i></div>
        <div>
          <div class="gr-card-name">{{ grupo.nome }}</div>
          {% if grupo.descricao %}<div class="gr-card-desc">{{ grupo.descricao }}</div>{% endif %}
        </div>
      </div>
      <div class="gr-card-body">
        <div class="gr-badges">
          <span class="gr-badge gr-badge-members"><i class="fas fa-user me-1"></i>{{ grupo.membros.count }} membro{{ grupo.membros.count|pluralize }}</span>
          <span class="gr-badge gr-badge-projects"><i class="fas fa-folder me-1"></i>{{ grupo.projetos.count }} projeto{{ grupo.projetos.count|pluralize }}</span>
          <span class="gr-badge gr-badge-tasks"><i class="fas fa-tasks me-1"></i>{{ grupo.tarefas.count }} tarefa{{ grupo.tarefas.count|pluralize }}</span>
        </div>
        {% if grupo.membros.exists %}
        <div class="gr-avatars">
          {% for m in grupo.membros.all|slice:":5" %}
          <span class="gr-avatar gr-avatar-{{ forloop.counter }}" title="{{ m.get_full_name|default:m.username }}">{{ m.first_name|slice:":1" }}{{ m.last_name|slice:":1" }}</span>
          {% endfor %}
          {% if grupo.membros.count > 5 %}<span class="gr-avatar gr-avatar-more">+{{ grupo.membros.count|add:"-5" }}</span>{% endif %}
        </div>
        {% endif %}
      </div>
      <div class="gr-card-foot">
        <a href="{% url 'projetos:grupo_detalhe' grupo.id %}" class="gr-btn gr-btn-outline gr-btn-sm"><i class="fas fa-eye"></i> Detalhes</a>
        <a href="{% url 'projetos:grupo_editar' grupo.id %}" class="gr-btn gr-btn-outline gr-btn-sm"><i class="fas fa-edit"></i></a>
        <a href="{% url 'projetos:grupo_excluir' grupo.id %}" class="gr-btn-danger-sm"><i class="fas fa-trash"></i></a>
      </div>
    </div>
    {% endfor %}
  </div>

  {% if grupos.has_other_pages %}
  <div class="gr-pagination">
    {% if grupos.has_previous %}<a href="?page={{ grupos.previous_page_number }}{% if termo_busca %}&busca={{ termo_busca }}{% endif %}"><i class="fas fa-chevron-left"></i></a>{% endif %}
    {% for num in grupos.paginator.page_range %}
      {% if grupos.number == num %}
        <span class="active">{{ num }}</span>
      {% elif num > grupos.number|add:'-3' and num < grupos.number|add:'3' %}
        <a href="?page={{ num }}{% if termo_busca %}&busca={{ termo_busca }}{% endif %}">{{ num }}</a>
      {% endif %}
    {% endfor %}
    {% if grupos.has_next %}<a href="?page={{ grupos.next_page_number }}{% if termo_busca %}&busca={{ termo_busca }}{% endif %}"><i class="fas fa-chevron-right"></i></a>{% endif %}
  </div>
  {% endif %}

  {% else %}
  <div class="gr-empty">
    <i class="fas fa-users"></i>
    <h4 style="font-size:.95rem;font-weight:600;margin:0 0 .3rem">Nenhum grupo encontrado</h4>
    <p style="font-size:.82rem;margin:0">Crie um novo grupo para organizar sua equipe</p>
  </div>
  {% endif %}
</div>
{% endblock %}