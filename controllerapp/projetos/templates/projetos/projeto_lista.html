{% extends 'layout.html' %}
{% load static %}

{% block title %}Projetos - FabLab IFMT{% endblock %}

{% block content %}
<!-- Hero -->
<section class="pg-hero">
  <div class="container">
    <span class="fl-tag">PORTFÓLIO</span>
    <h1 class="pg-hero-title">Nossos <span>Projetos</span></h1>
    <p class="pg-hero-sub">Explore os projetos desenvolvidos no FabLab IFMT e inspire-se para criar o seu!</p>
  </div>
</section>

<section class="fl-section">
  <div class="container">
    <!-- Tag filter alert -->
    {% if tag_ativa %}
    <div class="pg-tag-alert mb-4">
      <span><i class="fas fa-tag me-2"></i> Categoria: <strong>{{ tag_ativa }}</strong></span>
      <a href="{% url 'projetos:lista' %}" class="pg-btn-outline-sm">Ver todos</a>
    </div>
    {% endif %}

    {% if status_ativo %}
    <div class="pg-tag-alert mb-4">
      <span><i class="fas fa-filter me-2"></i> Status: <strong>{{ status_ativo }}</strong></span>
      <a href="{% url 'projetos:lista' %}" class="pg-btn-outline-sm">Limpar filtro</a>
    </div>
    {% endif %}

    <div class="row g-4">
      <!-- Sidebar -->
      <div class="col-lg-3">
        <div class="pg-sidebar sticky-lg-top" style="top:100px">
          <!-- Status -->
          <div class="pg-sidebar-card mb-3">
            <h5><i class="fas fa-sliders-h me-2"></i> Status</h5>
            <div class="pg-radio-group">
              <label class="pg-radio {% if not status_ativo %}active{% endif %}">
                <input type="radio" name="statusFilter" value="all" class="filter-status" {% if not status_ativo %}checked{% endif %}>
                <span>Todos</span>
              </label>
              {% for status_value, status_label in status_opcoes %}
              <label class="pg-radio {% if status_ativo == status_value %}active{% endif %}">
                <input type="radio" name="statusFilter" value="{{ status_value }}" class="filter-status" {% if status_ativo == status_value %}checked{% endif %}>
                <span>{{ status_label }}</span>
              </label>
              {% endfor %}
            </div>
          </div>

          <!-- Categorias -->
          {% if tags %}
          <div class="pg-sidebar-card">
            <h5><i class="fas fa-hashtag me-2"></i> Categorias</h5>
            <div class="pg-tags-row">
              <a href="{% url 'projetos:lista' %}" class="{% if not tag_ativa %}active{% endif %}">Todas</a>
              {% for tag in tags %}
                <a href="{% url 'projetos:lista' %}?tag={{ tag.slug }}" class="{% if tag_ativa == tag.slug %}active{% endif %}">{{ tag.nome }}</a>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Grid de projetos -->
      <div class="col-lg-9">
        {% if projetos %}
        <div class="row g-4">
          {% for projeto in projetos %}
          <div class="col-md-6 col-xl-4">
            <a href="{% url 'projetos:detalhe' projeto.slug %}" class="pg-card-project">
              <div class="pg-card-project-img">
                {% if projeto.imagem and projeto.imagem.name %}
                  <img src="{{ projeto.imagem.url }}" alt="{{ projeto.titulo }}" onerror="this.src='https://via.placeholder.com/350x200?text=Projeto'">
                {% else %}
                  <img src="https://via.placeholder.com/350x200?text=Projeto" alt="{{ projeto.titulo }}">
                {% endif %}
                <span class="pg-status-badge
                  {% if projeto.status == 'concluido' %}st-success{% endif %}
                  {% if projeto.status == 'em_andamento' %}st-primary{% endif %}
                  {% if projeto.status == 'planejado' %}st-info{% endif %}
                  {% if projeto.status == 'cancelado' %}st-muted{% endif %}">
                  {{ projeto.get_status_display }}
                </span>
              </div>
              <div class="pg-card-project-body">
                <h5>{{ projeto.titulo }}</h5>
                <p>{{ projeto.descricao_curta|truncatechars:100 }}</p>
                {% if projeto.tags.all %}
                <div class="pg-tags-mini">
                  {% for tag in projeto.tags.all %}
                    <span>{{ tag.nome }}</span>
                  {% endfor %}
                </div>
                {% endif %}
                <span class="pg-card-cta">Ver projeto <i class="fas fa-arrow-right ms-1"></i></span>
              </div>
            </a>
          </div>
          {% endfor %}
        </div>

        <!-- Paginação -->
        {% if projetos.paginator.num_pages > 1 %}
        <nav class="mt-5">
          <ul class="pg-pagination">
            {% if projetos.has_previous %}
              <li><a href="?page=1{% if tag_ativa %}&tag={{ tag_ativa }}{% endif %}{% if status_ativo %}&status={{ status_ativo }}{% endif %}">&laquo;</a></li>
              <li><a href="?page={{ projetos.previous_page_number }}{% if tag_ativa %}&tag={{ tag_ativa }}{% endif %}{% if status_ativo %}&status={{ status_ativo }}{% endif %}">Anterior</a></li>
            {% endif %}
            {% for num in projetos.paginator.page_range %}
              {% if projetos.number == num %}
                <li class="active"><span>{{ num }}</span></li>
              {% elif num > projetos.number|add:'-3' and num < projetos.number|add:'3' %}
                <li><a href="?page={{ num }}{% if tag_ativa %}&tag={{ tag_ativa }}{% endif %}{% if status_ativo %}&status={{ status_ativo }}{% endif %}">{{ num }}</a></li>
              {% endif %}
            {% endfor %}
            {% if projetos.has_next %}
              <li><a href="?page={{ projetos.next_page_number }}{% if tag_ativa %}&tag={{ tag_ativa }}{% endif %}{% if status_ativo %}&status={{ status_ativo }}{% endif %}">Próxima</a></li>
              <li><a href="?page={{ projetos.paginator.num_pages }}{% if tag_ativa %}&tag={{ tag_ativa }}{% endif %}{% if status_ativo %}&status={{ status_ativo }}{% endif %}">&raquo;</a></li>
            {% endif %}
          </ul>
        </nav>
        {% endif %}

        {% else %}
        <div class="pg-empty-state">
          <i class="fas fa-project-diagram"></i>
          <h4>Nenhum projeto encontrado</h4>
          <p>Não existem projetos com os filtros selecionados. Tente ajustar os filtros.</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.filter-status').forEach(function(r) {
    r.addEventListener('change', function() {
      var url = new URL(window.location.href);
      if (this.value === 'all') { url.searchParams.delete('status'); }
      else { url.searchParams.set('status', this.value); }
      url.searchParams.delete('page');
      window.location.href = url.toString();
    });
  });
});
</script>
{% endblock %}

{% block head %}
<style>
  .pg-hero { background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%); padding:4rem 0 3rem; position:relative; overflow:hidden; }
  .pg-hero::before { content:''; position:absolute; inset:0; background:radial-gradient(circle at 80% 40%,rgba(69,196,176,.12) 0%,transparent 60%); }
  .pg-hero-title { font-size:2.5rem; font-weight:800; color:#fff; letter-spacing:-.02em; margin-bottom:.5rem; }
  .pg-hero-title span { color:var(--accent-light); }
  .pg-hero-sub { color:rgba(255,255,255,.8); font-size:1.05rem; max-width:560px; }
  .fl-tag { display:inline-block; background:linear-gradient(135deg,var(--accent),var(--accent-light)); color:#fff; font-size:.7rem; font-weight:700; letter-spacing:.12em; padding:.35rem 1rem; border-radius:999px; margin-bottom:.75rem; text-transform:uppercase; }
  .fl-section { padding:5rem 0; }

  .pg-tag-alert { background:var(--surface-alt); border:1px solid var(--border); border-radius:var(--radius-sm); padding:.75rem 1.25rem; display:flex; justify-content:space-between; align-items:center; font-size:.9rem; }
  .pg-btn-outline-sm { padding:.35rem .85rem; border:2px solid var(--accent); color:var(--accent); border-radius:var(--radius-sm); font-size:.8rem; font-weight:600; text-decoration:none; transition:all var(--transition); }
  .pg-btn-outline-sm:hover { background:var(--accent); color:#fff; }

  .pg-sidebar-card { background:var(--white); border:1px solid var(--border); border-radius:var(--radius); padding:1.25rem; }
  .pg-sidebar-card h5 { font-size:.95rem; font-weight:700; color:var(--primary); margin-bottom:1rem; }

  .pg-radio-group { display:flex; flex-direction:column; gap:.35rem; }
  .pg-radio { display:flex; align-items:center; gap:.5rem; padding:.45rem .75rem; border-radius:var(--radius-sm); cursor:pointer; transition:all var(--transition); font-size:.85rem; color:var(--text); }
  .pg-radio:hover { background:var(--surface-alt); }
  .pg-radio.active { background:rgba(19,103,138,.06); color:var(--accent); font-weight:600; }
  .pg-radio input { accent-color:var(--accent); }

  .pg-tags-row { display:flex; flex-wrap:wrap; gap:.35rem; }
  .pg-tags-row a { background:rgba(19,103,138,.08); color:var(--accent); padding:.25rem .65rem; border-radius:999px; font-size:.75rem; font-weight:600; text-decoration:none; transition:all var(--transition); }
  .pg-tags-row a:hover, .pg-tags-row a.active { background:var(--accent); color:#fff; }

  /* Project card */
  .pg-card-project { display:flex; flex-direction:column; background:var(--white); border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; height:100%; text-decoration:none; transition:all var(--transition); }
  .pg-card-project:hover { transform:translateY(-8px); box-shadow:0 20px 40px rgba(11,37,69,.1); border-color:transparent; }
  .pg-card-project-img { position:relative; height:200px; overflow:hidden; }
  .pg-card-project-img img { width:100%; height:100%; object-fit:cover; transition:transform .5s; }
  .pg-card-project:hover .pg-card-project-img img { transform:scale(1.06); }
  .pg-status-badge { position:absolute; top:.75rem; left:.75rem; padding:.3rem .7rem; border-radius:999px; font-size:.72rem; font-weight:700; color:#fff; }
  .st-success { background:#10B981; }
  .st-primary { background:var(--accent); }
  .st-info { background:#3B82F6; }
  .st-muted { background:#6B7280; }
  .pg-card-project-body { padding:1.25rem; display:flex; flex-direction:column; flex:1; }
  .pg-card-project-body h5 { font-size:1.05rem; font-weight:700; color:var(--primary); margin-bottom:.4rem; line-height:1.4; }
  .pg-card-project-body p { font-size:.85rem; color:var(--text-muted); line-height:1.6; flex:1; }
  .pg-tags-mini { display:flex; flex-wrap:wrap; gap:.3rem; margin-bottom:.75rem; }
  .pg-tags-mini span { background:rgba(19,103,138,.06); color:var(--accent); padding:.2rem .55rem; border-radius:999px; font-size:.7rem; font-weight:600; }
  .pg-card-cta { color:var(--accent); font-weight:600; font-size:.85rem; }
  .pg-card-project:hover .pg-card-cta { color:var(--primary); }

  .pg-pagination { display:flex; justify-content:center; gap:.3rem; list-style:none; padding:0; }
  .pg-pagination li a, .pg-pagination li span { display:inline-block; padding:.5rem .85rem; border-radius:var(--radius-sm); font-size:.85rem; font-weight:600; text-decoration:none; transition:all var(--transition); border:1px solid var(--border); color:var(--text); background:var(--white); }
  .pg-pagination li a:hover { border-color:var(--accent); color:var(--accent); }
  .pg-pagination li.active span { background:var(--accent); color:#fff; border-color:var(--accent); }

  .pg-empty-state { text-align:center; padding:3rem; }
  .pg-empty-state i { font-size:3rem; color:var(--border); margin-bottom:1rem; display:block; }
  .pg-empty-state h4 { color:var(--text); font-weight:700; }
  .pg-empty-state p { color:var(--text-muted); }

  @media(max-width:768px){ .pg-hero-title{font-size:1.8rem;} .pg-hero{padding:3rem 0 2rem;} }
</style>
{% endblock %}