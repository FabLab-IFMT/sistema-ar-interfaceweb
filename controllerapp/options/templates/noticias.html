{% extends 'layout.html' %}
{% load static %}

{% block title %}{{ titulo|default:"Notícias" }} - FabLab IFMT{% endblock %}

{% block content %}
<!-- Hero -->
<section class="pg-hero">
  <div class="container">
    <span class="fl-tag">NOVIDADES</span>
    <h1 class="pg-hero-title">{{ titulo|default:"Notícias e <span>Comunicados</span>" }}</h1>
    <p class="pg-hero-sub">Fique por dentro das últimas novidades do FabLab IFMT</p>
  </div>
</section>

<section class="fl-section">
  <div class="container">
    {% if tag_atual %}
    <div class="pg-tag-alert mb-4">
      <span><i class="fas fa-tag me-2"></i> Mostrando notícias com a tag: <strong>#{{ tag_atual.nome }}</strong></span>
      <a href="{% url 'options:noticias' %}" class="pg-btn-details" style="padding:.4rem 1rem;width:auto;display:inline-block">Ver todas</a>
    </div>
    {% endif %}

    <div class="row g-4">
      <!-- Main content -->
      <div class="col-lg-9">
        {% if noticias %}
        <div class="row g-4">
          {% for noticia in noticias %}
          <div class="col-md-6 col-lg-4">
            <div class="pg-card-news">
              <div class="pg-card-news-img">
                <img src="{{ noticia.imagem.url }}" alt="{{ noticia.titulo }}">
                <span class="pg-news-date">{{ noticia.data_publicacao|date:"d/m/Y" }}</span>
                {% if noticia.destaque %}<span class="pg-news-featured"><i class="fas fa-star me-1"></i> Destaque</span>{% endif %}
              </div>
              <div class="pg-card-news-body">
                <h5>{{ noticia.titulo }}</h5>
                <p>{{ noticia.resumo|truncatechars:120 }}</p>
                {% if noticia.hashtags.all %}
                <div class="pg-tags-row mb-3">
                  {% for tag in noticia.hashtags.all %}
                    <a href="{% url 'options:noticias_por_tag' tag.slug %}">#{{ tag.nome }}</a>
                  {% endfor %}
                </div>
                {% endif %}
                <div class="d-flex justify-content-between align-items-center">
                  {% if noticia.autor %}
                    <small class="text-muted"><i class="fas fa-user me-1"></i> {{ noticia.autor.get_full_name|default:noticia.autor.username }}</small>
                  {% else %}<span></span>{% endif %}
                  <a href="{{ noticia.get_absolute_url }}" class="fl-link">Leia mais <i class="fas fa-arrow-right ms-1"></i></a>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

        <!-- Paginação -->
        {% if noticias.paginator.num_pages > 1 %}
        <nav class="mt-5">
          <ul class="pg-pagination">
            {% if noticias.has_previous %}
              <li><a href="?page=1">&laquo;</a></li>
              <li><a href="?page={{ noticias.previous_page_number }}">Anterior</a></li>
            {% endif %}
            {% for i in noticias.paginator.page_range %}
              {% if noticias.number == i %}
                <li class="active"><span>{{ i }}</span></li>
              {% elif i > noticias.number|add:'-3' and i < noticias.number|add:'3' %}
                <li><a href="?page={{ i }}">{{ i }}</a></li>
              {% endif %}
            {% endfor %}
            {% if noticias.has_next %}
              <li><a href="?page={{ noticias.next_page_number }}">Próxima</a></li>
              <li><a href="?page={{ noticias.paginator.num_pages }}">&raquo;</a></li>
            {% endif %}
          </ul>
        </nav>
        {% endif %}

        {% else %}
        <div class="pg-empty-state">
          <i class="fas fa-newspaper"></i>
          <h4>Nenhuma notícia disponível</h4>
          <p>No momento não há notícias publicadas. Volte em breve para novidades.</p>
        </div>
        {% endif %}
      </div>

      <!-- Sidebar -->
      <div class="col-lg-3">
        {% if hashtags %}
        <div class="pg-sidebar-card sticky-lg-top" style="top:100px">
          <h5><i class="fas fa-hashtag me-2"></i> Tópicos</h5>
          <div class="pg-tags-row">
            {% for tag in hashtags %}
              <a href="{% url 'options:noticias_por_tag' tag.slug %}" class="{% if tag_atual == tag %}active{% endif %}">#{{ tag.nome }}</a>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block head %}
<style>
  .pg-hero { background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%); padding:4rem 0 3rem; position:relative; overflow:hidden; }
  .pg-hero::before { content:''; position:absolute; inset:0; background:radial-gradient(circle at 80% 40%,rgba(69,196,176,.12) 0%,transparent 60%); }
  .pg-hero-title { font-size:2.5rem; font-weight:800; color:#fff; letter-spacing:-.02em; margin-bottom:.5rem; }
  .pg-hero-title span { color:var(--accent-light); }
  .pg-hero-sub { color:rgba(255,255,255,.8); font-size:1.05rem; max-width:560px; }
  .fl-tag { display:inline-block; background:linear-gradient(135deg,var(--accent),var(--accent-light)); color:#fff; font-size:.7rem; font-weight:700; letter-spacing:.12em; padding:.35rem 1rem; border-radius:999px; margin-bottom:.75rem; text-transform:uppercase; }
  .fl-heading { font-size:2.2rem; font-weight:800; color:var(--primary); letter-spacing:-.02em; margin-bottom:.6rem; }
  .fl-heading span { color:var(--accent); }
  .fl-section { padding:5rem 0; }
  .fl-section-alt { background:var(--surface-alt); }
  .fl-link { color:var(--accent); text-decoration:none; font-weight:600; font-size:.875rem; transition:color var(--transition); }
  .fl-link:hover { color:var(--primary); }

  .pg-tag-alert { background:var(--surface-alt); border:1px solid var(--border); border-radius:var(--radius-sm); padding:.75rem 1.25rem; display:flex; justify-content:space-between; align-items:center; font-size:.9rem; }

  /* News card */
  .pg-card-news { background:var(--white); border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; height:100%; transition:all var(--transition); }
  .pg-card-news:hover { transform:translateY(-6px); box-shadow:var(--shadow-lg); border-color:transparent; }
  .pg-card-news-img { position:relative; height:200px; overflow:hidden; }
  .pg-card-news-img img { width:100%; height:100%; object-fit:cover; transition:transform .5s; }
  .pg-card-news:hover .pg-card-news-img img { transform:scale(1.06); }
  .pg-news-date { position:absolute; top:.75rem; left:.75rem; background:var(--accent); color:#fff; padding:.3rem .7rem; border-radius:999px; font-size:.75rem; font-weight:600; }
  .pg-news-featured { position:absolute; top:.75rem; right:.75rem; background:#F59E0B; color:#fff; padding:.3rem .7rem; border-radius:999px; font-size:.75rem; font-weight:600; }
  .pg-card-news-body { padding:1.25rem; }
  .pg-card-news-body h5 { font-size:1.05rem; font-weight:700; color:var(--primary); margin-bottom:.4rem; line-height:1.4; }
  .pg-card-news-body p { font-size:.85rem; color:var(--text-muted); line-height:1.6; }

  .pg-tags-row { display:flex; flex-wrap:wrap; gap:.35rem; }
  .pg-tags-row a { background:rgba(19,103,138,.08); color:var(--accent); padding:.25rem .65rem; border-radius:999px; font-size:.75rem; font-weight:600; text-decoration:none; transition:all var(--transition); }
  .pg-tags-row a:hover, .pg-tags-row a.active { background:var(--accent); color:#fff; }

  .pg-sidebar-card { background:var(--white); border:1px solid var(--border); border-radius:var(--radius); padding:1.25rem; }
  .pg-sidebar-card h5 { font-size:.95rem; font-weight:700; color:var(--primary); margin-bottom:1rem; }

  .pg-pagination { display:flex; justify-content:center; gap:.3rem; list-style:none; padding:0; }
  .pg-pagination li a, .pg-pagination li span { display:inline-block; padding:.5rem .85rem; border-radius:var(--radius-sm); font-size:.85rem; font-weight:600; text-decoration:none; transition:all var(--transition); border:1px solid var(--border); color:var(--text); background:var(--white); }
  .pg-pagination li a:hover { border-color:var(--accent); color:var(--accent); }
  .pg-pagination li.active span { background:var(--accent); color:#fff; border-color:var(--accent); }

  .pg-empty-state { text-align:center; padding:3rem; }
  .pg-empty-state i { font-size:3rem; color:var(--border); margin-bottom:1rem; display:block; }
  .pg-empty-state h4 { color:var(--text); font-weight:700; }
  .pg-empty-state p { color:var(--text-muted); }

  .pg-btn-details { padding:.6rem 1rem; border:2px solid var(--accent); background:transparent; color:var(--accent); border-radius:var(--radius-sm); font-weight:600; font-size:.85rem; cursor:pointer; text-decoration:none; transition:all var(--transition); }
  .pg-btn-details:hover { background:var(--accent); color:#fff; }

  @media (max-width:768px) { .pg-hero-title { font-size:1.8rem; } .pg-hero { padding:3rem 0 2rem; } }
</style>
{% endblock %}