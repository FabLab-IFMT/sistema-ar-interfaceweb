{% extends 'layout.html' %}
{% load static %}

{% block title %}Soluções & Serviços{% endblock %}

{% block head %}
<style>
  /* === HERO SECTION (Blueprint Style) === */
  .service-hero {
    background-color: #0f172a;
    background-image: 
      linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
    background-size: 40px 40px;
    padding: 80px 0 100px 0; /* Extra padding bottom para sobrepor os filtros */
    margin-bottom: 0;
    color: white;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    position: relative;
  }

  .service-hero::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0; height: 100px;
    background: linear-gradient(to top, #f8f9fa, transparent);
    pointer-events: none;
  }

  /* === CATEGORY TABS (Floating) === */
  .category-nav-container {
    margin-top: -40px;
    position: relative;
    z-index: 10;
    margin-bottom: 3rem;
  }

  .category-nav {
    background: white;
    padding: 10px;
    border-radius: 50px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    display: inline-flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 5px;
    border: 1px solid rgba(0,0,0,0.05);
  }

  .cat-link {
    padding: 10px 25px;
    border-radius: 30px;
    text-decoration: none;
    color: #64748b;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .cat-link:hover {
    background-color: #f1f5f9;
    color: #0f172a;
  }

  .cat-link.active {
    background-color: var(--primary-blue, #0d6efd);
    color: white;
    box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
  }

  /* === SERVICE CARDS === */
  .service-card {
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 16px;
    overflow: hidden;
    height: 100%;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    position: relative;
    display: flex;
    flex-direction: column;
  }

  .service-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.08);
    border-color: var(--primary-blue, #0d6efd);
  }

  .card-img-wrapper {
    height: 180px;
    position: relative;
    overflow: hidden;
  }

  .service-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .service-card:hover .service-img {
    transform: scale(1.05);
  }

  /* Badge de Categoria */
  .cat-badge {
    position: absolute;
    top: 15px;
    left: 15px;
    background: rgba(15, 23, 42, 0.85);
    backdrop-filter: blur(4px);
    color: white;
    padding: 5px 12px;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    z-index: 2;
  }
  
  /* Badge de Destaque */
  .featured-ribbon {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #ffc107;
    color: #000;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 2;
  }

  .service-body {
    padding: 25px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }

  .service-title {
    font-weight: 700;
    font-size: 1.15rem;
    color: #1e293b;
    margin-bottom: 10px;
  }

  .service-desc {
    color: #64748b;
    font-size: 0.95rem;
    line-height: 1.5;
    margin-bottom: 20px;
    flex-grow: 1;
  }

  .meta-info {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    color: #94a3b8;
    background: #f8fafc;
    padding: 8px 12px;
    border-radius: 6px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* === PROCESS FLOW (How it Works) === */
  .process-section {
    background-color: #f8f9fa;
    padding: 80px 0;
    position: relative;
    overflow: hidden;
  }

  .process-line {
    position: absolute;
    top: 40px;
    left: 0;
    width: 100%;
    height: 2px;
    background-image: linear-gradient(to right, #e2e8f0 50%, transparent 50%);
    background-size: 20px 100%;
    z-index: 1;
    display: none; /* Escondido em mobile, mostrado em desktop via media query */
  }

  .process-step {
    position: relative;
    z-index: 2;
    text-align: center;
    padding: 0 15px;
  }

  .step-icon-box {
    width: 80px;
    height: 80px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px auto;
    font-size: 2rem;
    color: var(--primary-blue, #0d6efd);
    box-shadow: 0 10px 20px rgba(0,0,0,0.05);
    border: 4px solid #f8f9fa;
    transition: all 0.3s;
  }

  .process-step:hover .step-icon-box {
    background: var(--primary-blue, #0d6efd);
    color: white;
    transform: scale(1.1);
  }

  /* === FAQ ACCORDION CLEAN === */
  .accordion-clean .accordion-item {
    border: none;
    border-bottom: 1px solid #e2e8f0;
    background: transparent;
  }

  .accordion-clean .accordion-button {
    background: transparent;
    padding: 20px 0;
    font-weight: 600;
    color: #1e293b;
    box-shadow: none;
  }

  .accordion-clean .accordion-button:not(.collapsed) {
    color: var(--primary-blue, #0d6efd);
  }

  .accordion-clean .accordion-body {
    padding: 0 0 20px 0;
    color: #64748b;
  }

  /* Animações */
  .fade-up { animation: fadeUp 0.5s ease forwards; opacity: 0; transform: translateY(20px); }
  @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }

  @media (min-width: 992px) {
    .process-line { display: block; top: 120px; } /* Ajuste altura da linha */
  }
</style>
{% endblock %}

{% block content %}

<section class="service-hero text-center">
  <div class="container position-relative" style="z-index: 2;">
    <h1 class="display-4 fw-bold mb-2 tracking-tight">Serviços & Soluções</h1>
    <p class="lead text-white-50 mx-auto" style="max-width: 600px; font-weight: 300;">
      Transforme ideias em protótipos funcionais com nossa infraestrutura.
    </p>
  </div>
</section>

<div class="container text-center category-nav-container">
  <div class="category-nav">
    <a href="{% url 'options:servicos' %}" class="cat-link {% if not categoria_selecionada %}active{% endif %}">
      <i class="fas fa-th-large"></i> Todos
    </a>
    {% for categoria in categorias %}
      <a href="{% url 'options:servicos' %}?categoria={{ categoria.id }}" class="cat-link {% if categoria_selecionada == categoria.id|stringformat:'s' %}active{% endif %}">
        <i class="fas {{ categoria.icone|default:'fa-cube' }}"></i> {{ categoria.nome }}
      </a>
    {% endfor %}
  </div>
</div>

<section class="container mb-5">
  
  {% if categoria_selecionada %}
    <div class="mb-4">
      <h4 class="fw-bold text-dark"><i class="fas fa-filter me-2 text-primary"></i>Filtrado por Categoria</h4>
    </div>
  {% endif %}

  <div class="row g-4">
    {% if servicos %}
      {% for servico in servicos %}
        <div class="col-lg-4 col-md-6 fade-up" style="animation-delay: calc({{ forloop.counter0 }} * 100ms);">
          <div class="service-card h-100">
            <span class="cat-badge">{{ servico.categoria.nome }}</span>
            {% if servico.destaque %}
              <div class="featured-ribbon" title="Destaque">
                <i class="fas fa-star text-white" style="font-size: 0.8rem;"></i>
              </div>
            {% endif %}

            <div class="card-img-wrapper">
              {% if servico.imagem %}
                <img src="{{ servico.imagem.url }}" class="service-img" alt="{{ servico.nome }}">
              {% else %}
                <div class="w-100 h-100 d-flex align-items-center justify-content-center bg-light text-secondary">
                  <i class="fas fa-tools fa-3x opacity-25"></i>
                </div>
              {% endif %}
            </div>

            <div class="service-body">
              <h5 class="service-title">{{ servico.nome }}</h5>
              <p class="service-desc">{{ servico.descricao_curta|truncatechars:100 }}</p>
              
              {% if servico.tempo_estimado %}
                <div class="meta-info">
                  <i class="far fa-clock"></i> Tempo Estimado: {{ servico.tempo_estimado }}
                </div>
              {% endif %}

              <a href="{% url 'options:detalhe_servico' servico.id %}" class="btn btn-outline-primary w-100 mt-auto rounded-pill fw-bold">
                Detalhes & Requisitos
              </a>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="col-12 text-center py-5">
        <div class="p-5 bg-light rounded-3 border border-dashed">
          <i class="fas fa-search fa-3x text-muted mb-3 opacity-50"></i>
          <h4 class="text-muted">Nenhum serviço encontrado</h4>
          <p class="text-muted small">Tente selecionar outra categoria.</p>
          <a href="{% url 'options:servicos' %}" class="btn btn-primary mt-3 rounded-pill">Ver todos os serviços</a>
        </div>
      </div>
    {% endif %}
  </div>

  {% if servicos.paginator.num_pages > 1 %}
    <nav class="mt-5 d-flex justify-content-center">
      <ul class="pagination">
        {% if servicos.has_previous %}
          <li class="page-item">
            <a class="page-link rounded-start-pill border-0 bg-light text-dark" href="?page={{ servicos.previous_page_number }}{% if categoria_selecionada %}&categoria={{ categoria_selecionada }}{% endif %}">
              <i class="fas fa-chevron-left"></i>
            </a>
          </li>
        {% endif %}
        
        <li class="page-item disabled">
          <span class="page-link border-0 bg-transparent fw-bold text-dark">
            Página {{ servicos.number }} de {{ servicos.paginator.num_pages }}
          </span>
        </li>

        {% if servicos.has_next %}
          <li class="page-item">
            <a class="page-link rounded-end-pill border-0 bg-light text-dark" href="?page={{ servicos.next_page_number }}{% if categoria_selecionada %}&categoria={{ categoria_selecionada }}{% endif %}">
              <i class="fas fa-chevron-right"></i>
            </a>
          </li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
</section>

<section class="process-section">
  <div class="container">
    <div class="text-center mb-5 position-relative z-2">
      <h6 class="text-uppercase text-primary fw-bold ls-1 mb-2">Workflow</h6>
      <h2 class="fw-bold">Como funciona o processo?</h2>
    </div>

    <div class="position-relative">
      <div class="process-line d-none d-lg-block"></div>

      <div class="row gy-5">
        <div class="col-lg-3 col-md-6">
          <div class="process-step">
            <div class="step-icon-box">
              <i class="far fa-lightbulb"></i>
            </div>
            <h5 class="fw-bold">1. A Ideia</h5>
            <p class="text-muted small">Você traz o conceito, projeto ou necessidade.</p>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <div class="process-step">
            <div class="step-icon-box">
              <i class="far fa-comments"></i>
            </div>
            <h5 class="fw-bold">2. Consultoria</h5>
            <p class="text-muted small">Nossos monitores avaliam a viabilidade técnica.</p>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <div class="process-step">
            <div class="step-icon-box">
              <i class="fas fa-cogs"></i>
            </div>
            <h5 class="fw-bold">3. Execução</h5>
            <p class="text-muted small">Uso dos equipamentos com supervisão.</p>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <div class="process-step">
            <div class="step-icon-box">
              <i class="fas fa-rocket"></i>
            </div>
            <h5 class="fw-bold">4. Entrega</h5>
            <p class="text-muted small">Seu protótipo finalizado e pronto.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="text-center mb-5">
        <h2 class="fw-bold">Dúvidas Comuns</h2>
      </div>

      <div class="accordion accordion-clean" id="faqAccordion">
        
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
              <i class="fas fa-user-check me-3 opacity-50"></i> Quem pode utilizar?
            </button>
          </h2>
          <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
            <div class="accordion-body">
              O FabLab é aberto prioritariamente para alunos e servidores do IFMT. Membros da comunidade externa podem utilizar mediante agendamento de visitas ou parcerias específicas.
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
              <i class="fas fa-wallet me-3 opacity-50"></i> Existem custos envolvidos?
            </button>
          </h2>
          <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
            <div class="accordion-body">
              O uso das máquinas e a consultoria são <strong>gratuitos</strong>. No entanto, o usuário deve trazer seus próprios consumíveis (como filamento para 3D, chapas de MDF, componentes eletrônicos) para projetos pessoais.
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
              <i class="fas fa-shield-alt me-3 opacity-50"></i> Preciso de treinamento prévio?
            </button>
          </h2>
          <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
            <div class="accordion-body">
              Sim. Equipamentos de maior risco (como a CNC e Corte a Laser) exigem que o usuário passe por um treinamento de segurança oferecido pelo laboratório antes de operar a máquina, mesmo com supervisão.
            </div>
          </div>
        </div>

      </div>

      <div class="text-center mt-5">
        <p class="text-muted small">Ainda tem dúvidas?</p>
        <a href="https://www.instagram.com/ifmtmaker/" target="_blank" class="btn btn-sm btn-outline-dark rounded-pill px-4">
          <i class="fab fa-instagram me-2"></i>Fale Conosco
        </a>
      </div>
    </div>
  </div>
</section>

{% endblock %}