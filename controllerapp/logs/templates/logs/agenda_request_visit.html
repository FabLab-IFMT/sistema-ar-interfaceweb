{% extends 'layout.html' %}
{% load static %}

{% block title %}Agendar Visita — FabLab{% endblock %}

{% block head %}
<style>
/* ── Solicitar Visita ─────────────────────────────── */
.rv-hero{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%);padding:3rem 0 2.5rem;color:#fff;margin-bottom:2.5rem}
.rv-hero h1{font-weight:700;font-size:1.75rem;margin:0}
.rv-hero p{opacity:.8;margin:.5rem 0 0}
.rv-bc{display:flex;gap:.5rem;font-size:.85rem;opacity:.7;margin-bottom:.75rem}
.rv-bc a{color:#fff;text-decoration:none}
.rv-bc a:hover{text-decoration:underline}

.rv-card{background:var(--white);border-radius:var(--radius);box-shadow:0 4px 24px rgba(11,37,69,.07);overflow:hidden;margin-bottom:1.75rem}
.rv-card-head{background:var(--surface-alt);padding:1.15rem 1.75rem;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:.75rem}
.rv-card-head i{font-size:1.1rem;color:var(--accent)}
.rv-card-head h2{font-size:1.05rem;font-weight:600;margin:0;color:var(--text)}
.rv-card-body{padding:1.75rem}

.rv-g{margin-bottom:1.35rem}
.rv-g label{display:block;font-weight:600;font-size:.875rem;color:var(--text);margin-bottom:.4rem}
.rv-g label .req{color:#EF4444;margin-left:2px}
.rv-g .form-control,
.rv-g select{width:100%;border:1px solid var(--border);border-radius:var(--radius-sm);padding:.6rem .9rem;font-size:.9rem;transition:border var(--transition),box-shadow var(--transition);background:var(--white)}
.rv-g .form-control:focus,
.rv-g select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(19,103,138,.12);outline:none}
.rv-g textarea.form-control{resize:vertical;min-height:90px}
.rv-g .help{font-size:.8rem;color:var(--text-muted);margin-top:.3rem}
.rv-g .err{font-size:.8rem;color:#EF4444;margin-top:.3rem}

.rv-row2{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem}
.rv-row3{display:grid;grid-template-columns:2fr 1fr 1fr;gap:1.25rem}
@media(max-width:576px){.rv-row2,.rv-row3{grid-template-columns:1fr}}

.rv-steps{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:2rem}
@media(max-width:768px){.rv-steps{grid-template-columns:1fr}}
.rv-step{background:var(--white);border-radius:var(--radius);padding:1.25rem;text-align:center;border:1px solid var(--border);transition:all var(--transition)}
.rv-step:hover{border-color:var(--accent-light);transform:translateY(-2px);box-shadow:0 6px 20px rgba(19,103,138,.08)}
.rv-step-num{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent-light));color:#fff;display:inline-flex;align-items:center;justify-content:center;font-weight:700;font-size:.9rem;margin-bottom:.75rem}
.rv-step h3{font-size:.9rem;font-weight:600;margin:0 0 .25rem;color:var(--text)}
.rv-step p{font-size:.8rem;color:var(--text-muted);margin:0}

.rv-info{display:flex;align-items:flex-start;gap:.75rem;background:rgba(245,158,11,.06);border-left:3px solid #F59E0B;border-radius:var(--radius-sm);padding:1rem 1.25rem;margin-bottom:1.5rem}
.rv-info i{color:#F59E0B;margin-top:2px}
.rv-info p{margin:0;font-size:.875rem;color:var(--text)}

.rv-actions{display:flex;gap:.75rem;padding-top:.25rem}
.rv-actions .fl-btn{flex:1;display:inline-flex;align-items:center;justify-content:center;gap:.5rem;padding:.7rem 1.25rem;border-radius:var(--radius-sm);font-weight:600;font-size:.9rem;border:none;cursor:pointer;transition:all var(--transition);text-decoration:none}
.rv-actions .fl-btn-primary{background:var(--accent);color:#fff}
.rv-actions .fl-btn-primary:hover{background:var(--accent-light);transform:translateY(-1px);box-shadow:0 4px 12px rgba(19,103,138,.25)}
.rv-actions .fl-btn-outline{background:transparent;border:1.5px solid var(--border);color:var(--text-muted)}
.rv-actions .fl-btn-outline:hover{border-color:var(--text);color:var(--text)}
</style>
{% endblock %}

{% block content %}
<!-- Hero -->
<section class="rv-hero">
  <div class="container">
    <div class="rv-bc"><a href="{% url 'logs:agenda_home' %}">Agenda</a> <span>/</span> <span>Solicitar Visita</span></div>
    <h1><i class="fas fa-calendar-check me-2"></i>Agendar Visita ao FabLab</h1>
    <p>Preencha seus dados e escolha a data — é rápido e simples.</p>
  </div>
</section>

<div class="container" style="max-width:780px;margin-bottom:3rem">

  <!-- Steps -->
  <div class="rv-steps">
    <div class="rv-step">
      <div class="rv-step-num">1</div>
      <h3>Preencha o formulário</h3>
      <p>Seus dados e motivo da visita</p>
    </div>
    <div class="rv-step">
      <div class="rv-step-num">2</div>
      <h3>Aguarde aprovação</h3>
      <p>Análise em até 24 horas</p>
    </div>
    <div class="rv-step">
      <div class="rv-step-num">3</div>
      <h3>Receba confirmação</h3>
      <p>Email com os detalhes</p>
    </div>
  </div>

  {% if form.non_field_errors %}
    <div class="alert alert-danger mb-3">
      {% for error in form.non_field_errors %}{{ error }}{% endfor %}
    </div>
  {% endif %}

  <form method="post">
    {% csrf_token %}

    <!-- Dados do Visitante -->
    <div class="rv-card">
      <div class="rv-card-head"><i class="fas fa-user"></i><h2>Seus Dados</h2></div>
      <div class="rv-card-body">
        <div class="rv-row2">
          <div class="rv-g">
            <label for="{{ form.visitor_name.id_for_label }}">Nome Completo <span class="req">*</span></label>
            {{ form.visitor_name }}
            {% for error in form.visitor_name.errors %}<div class="err">{{ error }}</div>{% endfor %}
          </div>
          <div class="rv-g">
            <label for="{{ form.visitor_phone.id_for_label }}">Telefone <span class="req">*</span></label>
            {{ form.visitor_phone }}
            {% for error in form.visitor_phone.errors %}<div class="err">{{ error }}</div>{% endfor %}
          </div>
        </div>

        <div class="rv-row2">
          <div class="rv-g">
            <label for="{{ form.visitor_email.id_for_label }}">Email <span class="req">*</span></label>
            {{ form.visitor_email }}
            {% for error in form.visitor_email.errors %}<div class="err">{{ error }}</div>{% endfor %}
          </div>
          <div class="rv-g">
            <label for="{{ form.number_of_visitors.id_for_label }}">Nº de Visitantes <span class="req">*</span></label>
            {{ form.number_of_visitors }}
            <div class="help">Total incluindo você</div>
            {% for error in form.number_of_visitors.errors %}<div class="err">{{ error }}</div>{% endfor %}
          </div>
        </div>
      </div>
    </div>

    <!-- Informações da Visita -->
    <div class="rv-card">
      <div class="rv-card-head"><i class="fas fa-info-circle"></i><h2>Sobre a Visita</h2></div>
      <div class="rv-card-body">
        <div class="rv-g">
          <label for="{{ form.title.id_for_label }}">Motivo / Objetivo <span class="req">*</span></label>
          {{ form.title }}
          <div class="help">Ex.: Conhecer equipamentos de impressão 3D, palestra sobre prototipagem…</div>
          {% for error in form.title.errors %}<div class="err">{{ error }}</div>{% endfor %}
        </div>

        <div class="rv-g">
          <label for="{{ form.description.id_for_label }}">Detalhes Adicionais</label>
          {{ form.description }}
          <div class="help">Informações relevantes como necessidades especiais, equipamentos desejados, etc.</div>
          {% for error in form.description.errors %}<div class="err">{{ error }}</div>{% endfor %}
        </div>
      </div>
    </div>

    <!-- Data e Horário -->
    <div class="rv-card">
      <div class="rv-card-head"><i class="fas fa-clock"></i><h2>Data e Horário</h2></div>
      <div class="rv-card-body">
        <div class="rv-row3">
          <div class="rv-g">
            <label for="{{ form.visit_date.id_for_label }}">Data da Visita <span class="req">*</span></label>
            {{ form.visit_date }}
            {% for error in form.visit_date.errors %}<div class="err">{{ error }}</div>{% endfor %}
          </div>
          <div class="rv-g">
            <label for="{{ form.start_hour.id_for_label }}">Entrada <span class="req">*</span></label>
            {{ form.start_hour }}
            {% for error in form.start_hour.errors %}<div class="err">{{ error }}</div>{% endfor %}
          </div>
          <div class="rv-g">
            <label for="{{ form.end_hour.id_for_label }}">Saída <span class="req">*</span></label>
            {{ form.end_hour }}
            {% for error in form.end_hour.errors %}<div class="err">{{ error }}</div>{% endfor %}
          </div>
        </div>
        <div class="help" style="margin-top:-.5rem"><i class="fas fa-info-circle me-1"></i>Funcionamento: segunda a sexta, 08:00 – 18:00. Agende com pelo menos 48h de antecedência.</div>
      </div>
    </div>

    <!-- Campo oculto tipo de evento -->
    <div style="display:none">{{ form.event_type }}</div>

    <!-- Aviso -->
    <div class="rv-info">
      <i class="fas fa-exclamation-triangle"></i>
      <p>Sua solicitação será analisada pela equipe do FabLab. Você receberá um <strong>email de confirmação</strong> quando ela for aprovada.</p>
    </div>

    <!-- Ações -->
    <div class="rv-actions">
      <a href="{% url 'logs:agenda_home' %}" class="fl-btn fl-btn-outline"><i class="fas fa-arrow-left"></i> Cancelar</a>
      <button type="submit" class="fl-btn fl-btn-primary"><i class="fas fa-paper-plane"></i> Enviar Solicitação</button>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function(){
  // Máscara de telefone (jQuery Mask se disponível)
  if(window.jQuery && jQuery.fn.mask){
    jQuery('#{{ form.visitor_phone.id_for_label }}').mask('(00) 00000-0000',{
      onKeyPress:function(ph,e,f,o){
        var m=(ph.length>14)?'(00) 00000-0000':'(00) 0000-00009';
        jQuery('#{{ form.visitor_phone.id_for_label }}').mask(m,o);
      }
    });
  }
});
</script>
{% endblock %}
