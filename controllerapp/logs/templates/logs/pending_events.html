{% extends 'layout.html' %}
{% load static %}

{% block title %}Solicitações Pendentes — FabLab{% endblock %}

{% block head %}
<style>
/* ── Pendentes ────────────────────────────────────── */
.pe-hero{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%);padding:3rem 0 2.5rem;color:#fff;margin-bottom:2.5rem}
.pe-hero h1{font-weight:700;font-size:1.75rem;margin:0}
.pe-hero p{opacity:.8;margin:.5rem 0 0}
.pe-bc{display:flex;gap:.5rem;font-size:.85rem;opacity:.7;margin-bottom:.75rem}
.pe-bc a{color:#fff;text-decoration:none}
.pe-bc a:hover{text-decoration:underline}

.pe-cols{display:grid;grid-template-columns:1fr 1fr;gap:1.75rem}
@media(max-width:768px){.pe-cols{grid-template-columns:1fr}}

.pe-section-title{display:flex;align-items:center;gap:.6rem;margin-bottom:1.25rem}
.pe-section-title h2{font-size:1.1rem;font-weight:700;margin:0;color:var(--text)}
.pe-section-title .pe-count{display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;font-size:.75rem;font-weight:700;color:#fff}
.pe-count-visit{background:#EF4444}
.pe-count-other{background:#3B82F6}

.pe-card{background:var(--white);border-radius:var(--radius);box-shadow:0 4px 24px rgba(11,37,69,.07);overflow:hidden;margin-bottom:1.25rem;border-left:4px solid transparent;transition:all var(--transition)}
.pe-card:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(11,37,69,.1)}
.pe-card.visit-border{border-left-color:#EF4444}
.pe-card.other-border{border-left-color:#3B82F6}
.pe-card-body{padding:1.25rem 1.5rem}
.pe-card-top{display:flex;justify-content:space-between;align-items:flex-start;gap:.75rem;margin-bottom:.6rem}
.pe-card-top h3{font-size:1rem;font-weight:600;margin:0;color:var(--text)}
.pe-card-top .pe-date{font-size:.8rem;font-weight:600;padding:.25rem .7rem;border-radius:20px;background:var(--surface-alt);color:var(--text-muted);white-space:nowrap}
.pe-card-meta{display:flex;flex-wrap:wrap;gap:.75rem;font-size:.825rem;color:var(--text-muted);margin-bottom:.75rem}
.pe-card-meta i{margin-right:.25rem}
.pe-card-desc{font-size:.85rem;color:var(--text-muted);max-height:80px;overflow-y:auto;white-space:pre-line;background:var(--surface-alt);padding:.75rem;border-radius:var(--radius-sm);margin-bottom:1rem;line-height:1.5}
.pe-card-actions{display:flex;gap:.5rem;justify-content:flex-end}
.pe-card-actions .fl-btn{display:inline-flex;align-items:center;gap:.4rem;padding:.45rem .85rem;border-radius:var(--radius-sm);font-weight:600;font-size:.8rem;border:none;cursor:pointer;transition:all var(--transition);text-decoration:none}
.pe-card-actions .fl-btn-info{background:var(--surface-alt);color:var(--accent)}
.pe-card-actions .fl-btn-info:hover{background:rgba(19,103,138,.1)}
.pe-card-actions .fl-btn-approve{background:#059669;color:#fff}
.pe-card-actions .fl-btn-approve:hover{background:#10B981}
.pe-card-actions .fl-btn-reject{background:#EF4444;color:#fff}
.pe-card-actions .fl-btn-reject:hover{background:#DC2626}

.pe-empty{text-align:center;padding:2rem;color:var(--text-muted);font-style:italic;font-size:.9rem}

.pe-all-done{background:var(--white);border-radius:var(--radius);box-shadow:0 4px 24px rgba(11,37,69,.07);text-align:center;padding:3rem 2rem;margin-top:1rem}
.pe-all-done i{font-size:3rem;color:var(--accent-light);margin-bottom:1rem}
.pe-all-done h3{font-size:1.2rem;font-weight:700;color:var(--text);margin:0 0 .5rem}
.pe-all-done p{color:var(--text-muted);margin:0;font-size:.9rem}
</style>
{% endblock %}

{% block content %}
<!-- Hero -->
<section class="pe-hero">
  <div class="container">
    <div class="pe-bc"><a href="{% url 'logs:agenda_home' %}">Agenda</a> <span>/</span> <span>Pendentes</span></div>
    <h1><i class="fas fa-hourglass-half me-2"></i>Solicitações Pendentes</h1>
    <p>Avalie e gerencie as solicitações de eventos e visitas aguardando aprovação.</p>
  </div>
</section>

<div class="container" style="margin-bottom:3rem">

  {% if not visit_requests and not other_events %}
    <div class="pe-all-done">
      <i class="fas fa-check-circle"></i>
      <h3>Tudo certo!</h3>
      <p>Não há solicitações pendentes no momento. Todas foram processadas.</p>
    </div>
  {% else %}
    <div class="pe-cols">
      <!-- Solicitações de Visita -->
      <div>
        <div class="pe-section-title">
          <h2><i class="fas fa-users me-2" style="color:#EF4444"></i>Visitas</h2>
          <span class="pe-count pe-count-visit">{{ visit_requests|length }}</span>
        </div>

        {% for event in visit_requests %}
          <div class="pe-card visit-border">
            <div class="pe-card-body">
              <div class="pe-card-top">
                <h3>{{ event.title }}</h3>
                <span class="pe-date">{{ event.start_time|date:"d/m/Y" }}</span>
              </div>
              <div class="pe-card-meta">
                <span><i class="fas fa-user"></i>{{ event.created_by.first_name }} {{ event.created_by.last_name }}</span>
                <span><i class="fas fa-clock"></i>{{ event.start_time|date:"H:i" }} — {{ event.end_time|date:"H:i" }}</span>
              </div>
              {% if event.description %}
                <div class="pe-card-desc">{{ event.description|truncatechars:200 }}</div>
              {% endif %}
              <div class="pe-card-actions">
                <a href="{% url 'logs:agenda_event_detail' event.id %}" class="fl-btn fl-btn-info"><i class="fas fa-eye"></i> Detalhes</a>
                <a href="{% url 'logs:agenda_approve_event' event.id %}" class="fl-btn fl-btn-approve"><i class="fas fa-check"></i> Aprovar</a>
                <a href="{% url 'logs:agenda_delete_event' event.id %}" class="fl-btn fl-btn-reject"><i class="fas fa-times"></i> Rejeitar</a>
              </div>
            </div>
          </div>
        {% empty %}
          <div class="pe-empty"><i class="fas fa-inbox me-2"></i>Nenhuma visita pendente.</div>
        {% endfor %}
      </div>

      <!-- Outros Eventos -->
      <div>
        <div class="pe-section-title">
          <h2><i class="fas fa-calendar-alt me-2" style="color:#3B82F6"></i>Outros Eventos</h2>
          <span class="pe-count pe-count-other">{{ other_events|length }}</span>
        </div>

        {% for event in other_events %}
          <div class="pe-card other-border">
            <div class="pe-card-body">
              <div class="pe-card-top">
                <h3>{{ event.title }}</h3>
                <span class="pe-date">{{ event.get_event_type_display }}</span>
              </div>
              <div class="pe-card-meta">
                <span><i class="fas fa-user"></i>{{ event.created_by.first_name }} {{ event.created_by.last_name }}</span>
                <span><i class="fas fa-calendar-day"></i>{{ event.start_time|date:"d/m/Y" }}</span>
                <span><i class="fas fa-clock"></i>{{ event.start_time|date:"H:i" }} — {{ event.end_time|date:"H:i" }}</span>
              </div>
              {% if event.description %}
                <div class="pe-card-desc">{{ event.description|truncatechars:200 }}</div>
              {% endif %}
              <div class="pe-card-actions">
                <a href="{% url 'logs:agenda_event_detail' event.id %}" class="fl-btn fl-btn-info"><i class="fas fa-eye"></i> Detalhes</a>
                <a href="{% url 'logs:agenda_approve_event' event.id %}" class="fl-btn fl-btn-approve"><i class="fas fa-check"></i> Aprovar</a>
                <a href="{% url 'logs:agenda_delete_event' event.id %}" class="fl-btn fl-btn-reject"><i class="fas fa-times"></i> Rejeitar</a>
              </div>
            </div>
          </div>
        {% empty %}
          <div class="pe-empty"><i class="fas fa-inbox me-2"></i>Nenhum evento pendente.</div>
        {% endfor %}
      </div>
    </div>
  {% endif %}

</div>
{% endblock %}
